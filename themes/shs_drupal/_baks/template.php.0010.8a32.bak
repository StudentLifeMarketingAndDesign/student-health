<?php
function trim_text($text, $limit, $moreclass) {
  $extra = "<span class=\"$moreclass\">more...</span>";
  preg_match_all('/(\S+\s+)/',strip_tags($text),$matches);
  if ($limit < count($matches[0])) {
    return rtrim(implode('',array_slice($matches[0],0,$limit))) . $extra;
  } else {
    return $text;
  }
}
?>